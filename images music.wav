D=10; X=1.5; FPS=60; W=1920; H=1080; OUT="clip_pan_clean.mp4"; AUD="music.wav"; \
ls -1 *.png | sort > imgs.txt; \
python3 - <<PY
import shlex, subprocess
D=float("$D"); X=float("$X"); FPS=int("$FPS"); W=int("$W"); H=int("$H")
OUT="$OUT"; AUD="$AUD"
imgs=[l.strip() for l in open("imgs.txt") if l.strip()]

OW=int(W*2.0); OH=int(H*2.0)   # overscan 2x => pan stable (moins de jitter)

cmd=["ffmpeg","-y"]
for f in imgs:
    cmd += ["-loop","1","-t",str(D),"-i",f]
cmd += ["-i",AUD]

fg=[]
for i in range(len(imgs)):
    fg.append(
        f"[{i}:v]"
        f"scale={OW}:{OH}:force_original_aspect_ratio=increase,"
        f"crop={OW}:{OH},"
        f"crop={W}:{H}:x='(in_w-out_w)*t/{D}':y='(in_h-out_h)*0.35',"
        f"fps={FPS},format=yuv420p[v{i}]"
    )

cur="[v0]"
t=D-X
for i in range(1,len(imgs)):
    fg.append(f"{cur}[v{i}]xfade=transition=fade:duration={X}:offset={t}[x{i}]")
    cur=f"[x{i}]"
    t += D-X

fg.append(f"{cur}format=yuv420p[v]")

cmd += [
    "-filter_complex",";".join(fg),
    "-map","[v]","-map",f"{len(imgs)}:a",
    "-c:v","libx264","-crf","18","-preset","slow","-pix_fmt","yuv420p",
    "-c:a","aac","-b:a","320k",
    "-shortest",OUT
]

print(" ".join(shlex.quote(x) for x in cmd))
subprocess.run(cmd, check=True)
PY
